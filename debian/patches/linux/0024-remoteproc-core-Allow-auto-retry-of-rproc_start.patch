From 9a6862b0c89d5a05fe440992fbf7ecb3627c0b1b Mon Sep 17 00:00:00 2001
From: Xilin Wu <sophon@radxa.com>
Date: Tue, 10 Jun 2025 12:44:00 +0800
Subject: [PATCH 24/49] remoteproc: core: Allow auto retry of rproc_start()

Sometimes the remoteproc just does not want to start for the first time.
---
 drivers/remoteproc/remoteproc_core.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/drivers/remoteproc/remoteproc_core.c b/src/drivers/remoteproc/remoteproc_core.c
index 81b2ccf988e8..96450589144b 100644
--- a/src/drivers/remoteproc/remoteproc_core.c
+++ b/src/drivers/remoteproc/remoteproc_core.c
@@ -1432,9 +1432,13 @@ static int rproc_fw_boot(struct rproc *rproc, const struct firmware *fw)
 	}
 
 	ret = rproc_start(rproc, fw);
-	if (ret)
-		goto clean_up_resources;
-
+	if (ret) {
+		// HACK: try again
+		ret = rproc_start(rproc, fw);
+		if (ret) {
+			goto clean_up_resources;
+		}
+	}
 	return 0;
 
 clean_up_resources:
-- 
2.50.1

